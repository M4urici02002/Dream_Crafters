<%- include('includes/navbar.ejs') %>
<%- include('includes/sidebar.ejs') %>

<div class="main p-3 background-color">
  <div class="container form">
    <form class="crearUsuario" action="/gestionRoles/crearRol" method="POST">
      <input type="hidden" name="_csrf" value="<%= csrfToken %>">
      <h1 class="titulo-form">Crear Rol</h1>
      <div class="mb-5 contenido-con-margen">
        <label for="inputNombre" class="form-label label-crearUsuario">Nombre</label>
        <input type="text" class="form-control input-crearUsuario" id="nombreRol" name="nombreRol">

        <label for="asignarPrivilegio" class="form-label label-crearUsuario">Asignar privilegio</label>
        <select id="asignarPrivilegio" class="form-control input-crearUsuario" name="rol">
          <% for (let privilegio of privilegios) { %>
          <option><%= privilegio.permiso %></option>
          <% } %>
        </select>

        <label for="eliminarPrivilegio" class="form-label label-crearUsuario">Eliminar privilegio</label>
        <select id="eliminarPrivilegio" class="form-control input-crearUsuario" name="rol">
          <% for (let privilegio of privilegios) { %>
          <option><%= privilegio.permiso %></option>
          <% } %>
        </select>

        <label for="privilegiosSeleccionados" class="form-label label-crearUsuario">Privilegios seleccionados</label>
        <div id="privilegiosMostrados" class="card privilegio">
          <div class="card-body list-group-numbered">
            <!-- Elementos seleccionados mostrados dinÃ¡micamente -->
          </div>
        </div>

      </div>

      <div class="btn-formUsuario">
        <button type="submit" class="btn btn-dark">Enviar</button>
      </div>
    </form>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const asignarPrivilegioSelect = document.getElementById('asignarPrivilegio');
    const eliminarPrivilegioSelect = document.getElementById('eliminarPrivilegio');
    const privilegiosMostrados = document.getElementById('privilegiosMostrados');

    const actualizarPrivilegiosMostrados = () => {
      const asignados = [];
      const eliminados = [];

      if (asignarPrivilegioSelect.value) asignados.push(asignarPrivilegioSelect.value);
      if (eliminarPrivilegioSelect.value) eliminados.push(eliminarPrivilegioSelect.value);

      // Filtrar los privilegios mostrados para eliminar los seleccionados en "Eliminar privilegio"
      const nuevosPrivilegiosMostrados = Array.from(privilegiosMostrados.children)
        .map(item => item.textContent)
        .filter(privilegio => !eliminados.includes(privilegio));

      // Agregar los nuevos privilegios asignados
      asignados.forEach(privilegio => {
        if (!nuevosPrivilegiosMostrados.includes(privilegio)) {
          const listItem = document.createElement('li');
          listItem.className = 'list-group-item';
          listItem.textContent = privilegio;
          nuevosPrivilegiosMostrados.push(privilegio);
          privilegiosMostrados.appendChild(listItem);
        }
      });

      // Limpiar la lista y volver a agregar los privilegios actualizados
      privilegiosMostrados.innerHTML = '';
      nuevosPrivilegiosMostrados.forEach(privilegio => {
        const listItem = document.createElement('li');
        listItem.className = 'list-group-item';
        listItem.textContent = privilegio;
        privilegiosMostrados.appendChild(listItem);
      });
    };

    asignarPrivilegioSelect.addEventListener('change', actualizarPrivilegiosMostrados);
    eliminarPrivilegioSelect.addEventListener('change', actualizarPrivilegiosMostrados);
  });
</script>

<%- include('includes/footer.ejs') %>
